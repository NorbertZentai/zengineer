<div class="stats-container">
  <div class="stats-header">
    <h2>
      <mat-icon>analytics</mat-icon>
      {{ quiz.name }} - Statisztikák
    </h2>
    <button mat-icon-button (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="stats-content">
    <!-- Overview Cards -->
    <div class="overview-section">
      <h3>Áttekintés</h3>
      <div class="overview-grid">
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>style</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{ stats.totalCards }}</div>
              <div class="stat-label">Összes kártya</div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card mastered">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>check_circle</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{ stats.masteredCards }}</div>
              <div class="stat-label">Elsajátítva</div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card review">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>schedule</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{ stats.needsReview }}</div>
              <div class="stat-label">Ismétlendő</div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card accuracy">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>trending_up</mat-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value">{{ (stats.averageSuccessRate * 100).toFixed(0) }}%</div>
              <div class="stat-label">Átlagos pontosság</div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Progress Section -->
    <div class="progress-section">
      <h3>Haladás</h3>
      <mat-card>
        <mat-card-content>
          <div class="progress-item">
            <div class="progress-info">
              <span class="progress-label">Elsajátított kártyák</span>
              <span class="progress-percentage">
                {{ stats.totalCards > 0 ? ((stats.masteredCards / stats.totalCards) * 100).toFixed(0) : 0 }}%
              </span>
            </div>
            <mat-progress-bar 
              mode="determinate" 
              [value]="stats.totalCards > 0 ? (stats.masteredCards / stats.totalCards) * 100 : 0"
              [color]="getProgressColor((stats.masteredCards / stats.totalCards) * 100)">
            </mat-progress-bar>
          </div>

          <div class="progress-item">
            <div class="progress-info">
              <span class="progress-label">Átlagos pontosság</span>
              <span class="progress-percentage">{{ (stats.averageSuccessRate * 100).toFixed(0) }}%</span>
            </div>
            <mat-progress-bar 
              mode="determinate" 
              [value]="stats.averageSuccessRate * 100"
              [color]="getProgressColor(stats.averageSuccessRate * 100)">
            </mat-progress-bar>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Difficulty Distribution -->
    <div class="distribution-section">
      <h3>Nehézségi megoszlás</h3>
      <mat-card>
        <mat-card-content>
          <div class="difficulty-chart">
            <div 
              *ngFor="let item of getDifficultyDistribution() | keyvalue"
              class="difficulty-item">
              <div class="difficulty-info">
                <span 
                  class="difficulty-label"
                  [class]="item.key">
                  {{ item.key === 'easy' ? 'Könnyű' : item.key === 'medium' ? 'Közepes' : 'Nehéz' }}
                </span>
                <span class="difficulty-count">{{ item.value }}</span>
              </div>
              <div class="difficulty-bar">
                <div 
                  class="difficulty-fill"
                  [class]="item.key"
                  [style.width.%]="stats.totalCards > 0 ? (item.value / stats.totalCards) * 100 : 0">
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Tags Distribution -->
    <div class="tags-section" *ngIf="getTagDistribution().length > 0">
      <h3>Leggyakoribb címkék</h3>
      <mat-card>
        <mat-card-content>
          <div class="tags-chart">
            <div 
              *ngFor="let tag of getTagDistribution()"
              class="tag-item">
              <span class="tag-name">{{ tag[0] }}</span>
              <div class="tag-bar">
                <div 
                  class="tag-fill"
                  [style.width.%]="(tag[1] / stats.totalCards) * 100">
                </div>
              </div>
              <span class="tag-count">{{ tag[1] }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quiz Info -->
    <div class="info-section">
      <h3>Kvíz információk</h3>
      <mat-card>
        <mat-card-content>
          <div class="info-grid">
            <div class="info-item">
              <mat-icon>event</mat-icon>
              <div class="info-details">
                <span class="info-label">Létrehozva</span>
                <span class="info-value">{{ formatDate(quiz.created) }}</span>
              </div>
            </div>

            <div class="info-item">
              <mat-icon>update</mat-icon>
              <div class="info-details">
                <span class="info-label">Utolsó módosítás</span>
                <span class="info-value">{{ formatDate(quiz.updated) }}</span>
              </div>
            </div>

            <div class="info-item" *ngIf="quiz.description">
              <mat-icon>description</mat-icon>
              <div class="info-details">
                <span class="info-label">Leírás</span>
                <span class="info-value">{{ quiz.description }}</span>
              </div>
            </div>

            <div class="info-item" *ngIf="quiz.tags.length > 0">
              <mat-icon>local_offer</mat-icon>
              <div class="info-details">
                <span class="info-label">Címkék</span>
                <div class="tags-list">
                  <span 
                    *ngFor="let tag of quiz.tags"
                    class="tag-chip">
                    {{ tag }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Study Recommendations -->
    <div class="recommendations-section" *ngIf="stats.needsReview > 0 || stats.averageSuccessRate < 0.8">
      <h3>Tanulási javaslatok</h3>
      <mat-card>
        <mat-card-content>
          <div class="recommendations">
            <div class="recommendation" *ngIf="stats.needsReview > 0">
              <mat-icon class="recommendation-icon warning">schedule</mat-icon>
              <div class="recommendation-content">
                <h4>Ismétlés szükséges</h4>
                <p>{{ stats.needsReview }} kártya vár ismétlésre. Javasoljuk, hogy folytasd a tanulást!</p>
              </div>
            </div>

            <div class="recommendation" *ngIf="stats.averageSuccessRate < 0.6">
              <mat-icon class="recommendation-icon error">trending_down</mat-icon>
              <div class="recommendation-content">
                <h4>Több gyakorlásra van szükség</h4>
                <p>Az átlagos pontosság alacsony. Próbáld meg többször átismételni a nehezebb kártyákat!</p>
              </div>
            </div>

            <div class="recommendation" *ngIf="stats.averageSuccessRate >= 0.6 && stats.averageSuccessRate < 0.8">
              <mat-icon class="recommendation-icon info">info</mat-icon>
              <div class="recommendation-content">
                <h4>Jó úton jársz!</h4>
                <p>Szép munka! Még egy kis gyakorlás és tökéletes lesz az eredmény.</p>
              </div>
            </div>

            <div class="recommendation" *ngIf="stats.averageSuccessRate >= 0.9">
              <mat-icon class="recommendation-icon success">star</mat-icon>
              <div class="recommendation-content">
                <h4>Kiváló teljesítmény!</h4>
                <p>Nagyszerű munka! Már jól elsajátítottad ezt a kvízt.</p>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <div class="stats-actions">
    <button mat-raised-button color="primary" (click)="close()">
      <mat-icon>check</mat-icon>
      Bezárás
    </button>
  </div>
</div>
