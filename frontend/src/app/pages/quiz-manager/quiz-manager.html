<div class="quiz-manager-container">
  <!-- Header with search and controls -->
  <header class="manager-header">
    <div class="header-left">
      <nav class="breadcrumb" *ngIf="breadcrumb().length > 0">
        <button 
          mat-icon-button 
          (click)="navigateToFolder(null)"
          [matTooltip]="'QUIZ_MANAGER.HOME' | translate">
          <mat-icon>home</mat-icon>
        </button>
        <ng-container *ngFor="let folder of breadcrumb(); let last = last">
          <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
          <button 
            *ngIf="!last"
            mat-button 
            (click)="navigateToFolder(folder)"
            class="breadcrumb-item">
            {{ folder.name }}
          </button>
          <span *ngIf="last" class="breadcrumb-current">{{ folder.name }}</span>
        </ng-container>
      </nav>
      <h1 class="page-title" *ngIf="breadcrumb().length === 0">
        <mat-icon class="title-icon">quiz</mat-icon>
        {{ 'QUIZ_MANAGER.PAGE_TITLE' | translate }}
      </h1>
    </div>
    
    <div class="header-right">
      <!-- Search -->
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>{{ 'QUIZ_MANAGER.SEARCH_PLACEHOLDER' | translate }}</mat-label>
        <input 
          matInput 
          [value]="quizService.searchQuery()"
          (input)="onSearch($any($event.target).value)"
          [placeholder]="'QUIZ_MANAGER.SEARCH_BY' | translate">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
      
      <!-- View mode controls -->
      <div class="view-controls">
        <button 
          mat-icon-button 
          [class.active]="viewMode() === 'grid'"
          (click)="setViewMode('grid')"
          [matTooltip]="'QUIZ_MANAGER.VIEW_GRID' | translate">
          <mat-icon>grid_view</mat-icon>
        </button>
        <button 
          mat-icon-button 
          [class.active]="viewMode() === 'list'"
          (click)="setViewMode('list')"
          [matTooltip]="'QUIZ_MANAGER.VIEW_LIST' | translate">
          <mat-icon>view_list</mat-icon>
        </button>
      </div>
      
      <!-- Sort controls -->
      <button 
        mat-icon-button 
        [matMenuTriggerFor]="sortMenu" 
        [matTooltip]="'QUIZ_MANAGER.SORT' | translate">
        <mat-icon>sort</mat-icon>
      </button>
      <mat-menu #sortMenu="matMenu">
        <button mat-menu-item (click)="setSortBy('name')">
          <mat-icon>{{ sortBy() === 'name' ? (sortAscending() ? 'keyboard_arrow_up' : 'keyboard_arrow_down') : 'sort_by_alpha' }}</mat-icon>
          {{ 'QUIZ_MANAGER.SORT_BY_NAME' | translate }}
        </button>
        <button mat-menu-item (click)="setSortBy('created')">
          <mat-icon>{{ sortBy() === 'created' ? (sortAscending() ? 'keyboard_arrow_up' : 'keyboard_arrow_down') : 'schedule' }}</mat-icon>
          {{ 'QUIZ_MANAGER.SORT_BY_CREATED' | translate }}
        </button>
        <button mat-menu-item (click)="setSortBy('updated')">
          <mat-icon>{{ sortBy() === 'updated' ? (sortAscending() ? 'keyboard_arrow_up' : 'keyboard_arrow_down') : 'update' }}</mat-icon>
          {{ 'QUIZ_MANAGER.SORT_BY_UPDATED' | translate }}
        </button>
        <button mat-menu-item (click)="setSortBy('cards')">
          <mat-icon>{{ sortBy() === 'cards' ? (sortAscending() ? 'keyboard_arrow_up' : 'keyboard_arrow_down') : 'style' }}</mat-icon>
          {{ 'QUIZ_MANAGER.SORT_BY_CARDS' | translate }}
        </button>
      </mat-menu>
    </div>
  </header>

  <!-- Statistics bar -->
  <div class="stats-bar" *ngIf="folderStats() as stats">
    <div class="stat-item">
      <mat-icon>quiz</mat-icon>
      <span>{{ stats.totalQuizzes }} {{ 'QUIZ_MANAGER.STATS.QUIZZES' | translate }}</span>
    </div>
    <div class="stat-item">
      <mat-icon>style</mat-icon>
      <span>{{ stats.totalCards }} {{ 'QUIZ_MANAGER.STATS.CARDS' | translate }}</span>
    </div>
    <div class="stat-item" *ngIf="stats.needsReview > 0">
      <mat-icon>schedule</mat-icon>
      <span>{{ stats.needsReview }} {{ 'QUIZ_MANAGER.STATS.NEEDS_REVIEW' | translate }}</span>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="action-bar">
    <button 
      mat-raised-button 
      color="primary"
      (click)="showCreateFolderDialog()"
      class="create-btn">
      <mat-icon>create_new_folder</mat-icon>
      {{ 'QUIZ_MANAGER.ACTIONS.NEW_FOLDER' | translate }}
    </button>
    <button 
      mat-raised-button 
      color="accent"
      (click)="showCreateQuizDialog()"
      class="create-btn">
      <mat-icon>add</mat-icon>
      {{ 'QUIZ_MANAGER.ACTIONS.NEW_QUIZ' | translate }}
    </button>
  </div>

  <!-- Content area -->
  <main class="content-area" *ngIf="!quizService.isLoading()">
    <!-- Quizzes display -->
    <section class="quizzes-section">
      <h2 class="section-title">
        <mat-icon>quiz</mat-icon>
        {{ 'QUIZ_MANAGER.STATS.QUIZZES' | translate | titlecase }}
        <span class="count" *ngIf="displayedQuizzes().length > 0">({{ displayedQuizzes().length }})</span>
      </h2>
      
      <!-- Grid view -->
      <div 
        *ngIf="viewMode() === 'grid'" 
        class="quizzes-grid">
        <mat-card 
          *ngFor="let quiz of displayedQuizzes(); trackBy: trackByQuizId"
          class="quiz-card"
          [style.border-left-color]="quiz.color">
          
          <mat-card-header>
            <mat-icon 
              [style.color]="quiz.color"
              mat-card-avatar>
              {{ quiz.icon || 'quiz' }}
            </mat-icon>
            <mat-card-title>{{ quiz.name }}</mat-card-title>
            <mat-card-subtitle *ngIf="quiz.description">{{ quiz.description }}</mat-card-subtitle>
            
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="quizMenu"
              class="card-menu-btn">
              <mat-icon>more_vert</mat-icon>
            </button>
            
            <mat-menu #quizMenu="matMenu">
              <button mat-menu-item (click)="navigateToQuiz(quiz)">
                <mat-icon>visibility</mat-icon>
                {{ 'QUIZ_MANAGER.ACTIONS.OPEN' | translate }}
              </button>
              <button mat-menu-item (click)="openCardEditor(quiz)">
                <mat-icon>edit</mat-icon>
                {{ 'QUIZ_MANAGER.ACTIONS.EDIT_CARDS' | translate }}
              </button>
              <button mat-menu-item (click)="startStudyMode(quiz)" [disabled]="(quiz.cards?.length ?? 0) === 0">
                <mat-icon>school</mat-icon>
                {{ 'QUIZ_MANAGER.ACTIONS.STUDY' | translate }}
              </button>
              <button mat-menu-item (click)="showQuizStats(quiz)">
                <mat-icon>analytics</mat-icon>
                {{ 'QUIZ_MANAGER.ACTIONS.STATISTICS' | translate }}
              </button>
              <mat-divider></mat-divider>
              <button mat-menu-item (click)="exportQuiz(quiz)">
                <mat-icon>download</mat-icon>
                {{ 'QUIZ_MANAGER.ACTIONS.EXPORT' | translate }}
              </button>
              <button mat-menu-item (click)="deleteQuiz(quiz)">
                <mat-icon>delete</mat-icon>
                {{ 'QUIZ_MANAGER.ACTIONS.DELETE' | translate }}
              </button>
            </mat-menu>
          </mat-card-header>
          
          <mat-card-content>
            <div class="quiz-stats">
              <div class="stat-row">
                <span class="stat">
                  <mat-icon>style</mat-icon>
                  {{ quiz.cards?.length ?? 0 }} {{ 'QUIZ_MANAGER.STATS.CARDS' | translate }}
                </span>
                <span class="stat" *ngIf="quizService.getCardsNeedingReview(quiz).length > 0">
                  <mat-icon>schedule</mat-icon>
                  {{ quizService.getCardsNeedingReview(quiz).length }} {{ 'QUIZ_MANAGER.STATS.NEEDS_REVIEW' | translate }}
                </span>
              </div>
            </div>
            
            <div class="quiz-tags" *ngIf="(quiz.tags?.length ?? 0) > 0">
              <mat-chip *ngFor="let tag of quiz.tags" class="tag-chip">{{ tag }}</mat-chip>
            </div>
          </mat-card-content>
          
          <mat-card-actions>
            <button 
              mat-button 
              color="primary"
              (click)="startStudyMode(quiz)"
              [disabled]="(quiz.cards?.length ?? 0) === 0">
              <mat-icon>school</mat-icon>
              {{ 'QUIZ_MANAGER.ACTIONS.STUDY' | translate }}
            </button>
            <button 
              mat-button 
              (click)="openCardEditor(quiz)">
              <mat-icon>edit</mat-icon>
              {{ 'QUIZ_MANAGER.ACTIONS.EDIT' | translate }}
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
      
      <!-- Empty state -->
      <div class="empty-state" *ngIf="displayedQuizzes().length === 0 && !quizService.searchQuery()">
        <mat-icon class="empty-icon">quiz</mat-icon>
        <h3>{{ 'QUIZ_MANAGER.EMPTY_STATE.NO_QUIZZES' | translate }}</h3>
        <p>{{ 'QUIZ_MANAGER.EMPTY_STATE.NO_QUIZZES_DESC' | translate }}</p>
        <button 
          mat-raised-button 
          color="primary"
          (click)="showCreateQuizDialog()">
          <mat-icon>add</mat-icon>
          {{ 'QUIZ_MANAGER.EMPTY_STATE.CREATE_QUIZ' | translate }}
        </button>
      </div>
      
      <!-- No search results -->
      <div class="empty-state" *ngIf="displayedQuizzes().length === 0 && quizService.searchQuery()">
        <mat-icon class="empty-icon">search_off</mat-icon>
        <h3>{{ 'QUIZ_MANAGER.EMPTY_STATE.NO_RESULTS' | translate }}</h3>
        <p>{{ 'QUIZ_MANAGER.EMPTY_STATE.NO_RESULTS_DESC' | translate }}</p>
      </div>
    </section>
  </main>
</div>

<!-- Create Dialog -->
<div class="create-dialog-overlay" *ngIf="showCreateDialog()" (click)="cancelCreate()">
  <div class="create-dialog" (click)="$event.stopPropagation()">
    <div class="dialog-header">
      <h2>
        <mat-icon>{{ createType() === 'folder' ? 'create_new_folder' : 'add' }}</mat-icon>
        {{ createType() === 'folder' ? ('QUIZ_MANAGER.CREATE_DIALOG.NEW_FOLDER' | translate) : ('QUIZ_MANAGER.CREATE_DIALOG.NEW_QUIZ' | translate) }}
      </h2>
      <button mat-icon-button (click)="cancelCreate()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <div class="dialog-content">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'QUIZ_MANAGER.CREATE_DIALOG.NAME' | translate }}</mat-label>
        <input 
          matInput 
          [ngModel]="createName()"
          (ngModelChange)="createName.set($event)"
          [placeholder]="'QUIZ_MANAGER.CREATE_DIALOG.NAME_PLACEHOLDER' | translate"
          (keydown.enter)="confirmCreate()">
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'QUIZ_MANAGER.CREATE_DIALOG.DESCRIPTION' | translate }}</mat-label>
        <textarea 
          matInput 
          [ngModel]="createDescription()"
          (ngModelChange)="createDescription.set($event)"
          rows="3"
          [placeholder]="'QUIZ_MANAGER.CREATE_DIALOG.DESCRIPTION_PLACEHOLDER' | translate">
        </textarea>
      </mat-form-field>
      
      <div class="customization-section">
        <h4>{{ 'QUIZ_MANAGER.CREATE_DIALOG.CUSTOMIZATION' | translate }}</h4>
        
        <div class="color-selection">
          <span class="selection-label">{{ 'QUIZ_MANAGER.CREATE_DIALOG.COLOR' | translate }}</span>
          <div class="color-options">
            <button 
              *ngFor="let color of colorOptions"
              class="color-option"
              [class.selected]="selectedColor() === color"
              [style.background-color]="color"
              (click)="selectedColor.set(color)">
            </button>
          </div>
        </div>
        
        <div class="icon-selection">
          <span class="selection-label">{{ 'QUIZ_MANAGER.CREATE_DIALOG.ICON' | translate }}</span>
          <div class="icon-options">
            <button 
              *ngFor="let icon of iconOptions"
              mat-icon-button
              class="icon-option"
              [class.selected]="selectedIcon() === icon"
              (click)="selectedIcon.set(icon)">
              <mat-icon>{{ icon }}</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="dialog-actions">
      <button mat-button (click)="cancelCreate()">{{ 'QUIZ_MANAGER.CREATE_DIALOG.CANCEL' | translate }}</button>
      <button 
        mat-raised-button 
        color="primary"
        (click)="confirmCreate()"
        [disabled]="!createName().trim()">
        {{ 'QUIZ_MANAGER.CREATE_DIALOG.CREATE' | translate }}
      </button>
    </div>
  </div>
</div>
