<div class="study-mode-container" *ngIf="!showResult()">
  <!-- Header -->
  <div class="study-header">
    <div class="header-left">
      <button class="exit-btn" (click)="exitStudy()">
        <span class="close-icon"></span>
      </button>
      <h2>{{ quiz.name }}</h2>
    </div>
    
    <div class="header-center">
      <!-- Study Mode Selector -->
      <div class="mode-selector">
        <button 
          class="mode-btn"
          [class.active]="studyMode() === 'classic'"
          (click)="changeStudyMode('classic')">
          <span class="quiz-icon"></span>
          Összes kártya
        </button>
        <button 
          class="mode-btn"
          [class.active]="studyMode() === 'review'"
          (click)="changeStudyMode('review')">
          <span class="schedule-icon"></span>
          Ismétlendő
        </button>
        <button 
          class="mode-btn"
          [class.active]="studyMode() === 'hard_cards'"
          (click)="changeStudyMode('hard_cards')">
          <span class="trending-up-icon"></span>
          Nehéz kártyák
        </button>
      </div>
    </div>
    
    <div class="header-right">
      <div class="timer">
        <span class="schedule-icon"></span>
        {{ formatTime(elapsedTime()) }}
      </div>
    </div>
  </div>
  
  <!-- Progress Bar -->
  <div class="progress-section">
    <div class="progress-info">
      <span class="progress-text">
        {{ currentCardIndex() + 1 }} / {{ studyCards().length }}
      </span>
      <span class="accuracy" [style.color]="getAccuracyColor(studyStats().accuracy)">
        {{ studyStats().accuracy.toFixed(0) }}% pontosság
      </span>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar-fill study-progress" 
           [style.width.%]="progress()">
      </div>
    </div>
  </div>
  
  <!-- Study Card -->
  <div class="study-area" *ngIf="currentCard() as card">
    <div class="card-info">
      <span 
        class="difficulty-badge"
        [style.background-color]="getCardDifficultyColor(card.difficulty)">
        {{ getCardDifficultyLabel(card.difficulty) }}
      </span>
      <div class="card-tags" *ngIf="card.tags.length > 0">
        <span class="tag-chip" *ngFor="let tag of card.tags">{{ tag }}</span>
      </div>
    </div>
    
    <div class="study-card" 
         [class.flipped]="isFlipped()"
         (click)="flipCard()">
      <div class="card-inner">
        <div class="card-face card-front">
          <div class="card-content">
            <div class="flip-hint" *ngIf="!isFlipped()">
              <span class="touch-icon"></span>
              Kattints a válasz megtekintéséhez
            </div>
            <div class="card-text">{{ card.front }}</div>
          </div>
        </div>
        <div class="card-face card-back">
          <div class="card-content">
            <div class="card-text">{{ card.back }}</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="study-actions" *ngIf="isFlipped()">
      <button 
        class="action-btn wrong-btn"
        (click)="answerCard(false)">
        <span class="close-icon"></span>
        Nem tudtam
      </button>
      <button 
        class="action-btn skip-btn"
        (click)="skipCard()">
        <span class="skip-icon"></span>
        Kihagyás
      </button>
      <button 
        class="action-btn correct-btn"
        (click)="answerCard(true)">
        <span class="check-icon"></span>
        Tudtam
      </button>
    </div>
    
    <div class="card-controls" *ngIf="!isFlipped()">
      <button class="control-btn" (click)="resetCard()">
        <span class="refresh-icon"></span>
        Újra
      </button>
      <button class="control-btn" (click)="flipCard()">
        <span class="flip-icon"></span>
        Válasz mutatása
      </button>
    </div>
  </div>
  
  <!-- Stats Panel -->
  <div class="stats-panel">
    <div class="stat-item correct">
      <span class="check-circle-icon"></span>
      <span class="stat-value">{{ studyStats().correct }}</span>
      <span class="stat-label">Helyes</span>
    </div>
    <div class="stat-item wrong">
      <span class="cancel-icon"></span>
      <span class="stat-value">{{ studyStats().wrong }}</span>
      <span class="stat-label">Helytelen</span>
    </div>
    <div class="stat-item remaining">
      <span class="schedule-icon"></span>
      <span class="stat-value">{{ studyStats().remaining }}</span>
      <span class="stat-label">Hátra</span>
    </div>
  </div>
</div>

<!-- Results Screen -->
<div class="results-container" *ngIf="showResult()">
  <div class="results-header">
    <span class="results-icon trophy-icon"></span>
    <h2>Tanulás befejezve!</h2>
  </div>
  
  <div class="results-stats">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value large">{{ studyStats().total }}</div>
        <div class="stat-label">Összes kártya</div>
      </div>
      <div class="stat-card correct">
        <div class="stat-value large">{{ studyStats().correct }}</div>
        <div class="stat-label">Helyes válasz</div>
      </div>
      <div class="stat-card wrong">
        <div class="stat-value large">{{ studyStats().wrong }}</div>
        <div class="stat-label">Helytelen válasz</div>
      </div>
      <div class="stat-card accuracy" [style.color]="getAccuracyColor(studyStats().accuracy)">
        <div class="stat-value large">{{ studyStats().accuracy.toFixed(0) }}%</div>
        <div class="stat-label">Pontosság</div>
      </div>
      <div class="stat-card time">
        <div class="stat-value large">{{ formatTime(elapsedTime()) }}</div>
        <div class="stat-label">Tanulási idő</div>
      </div>
    </div>
    
    <div class="performance-message">
      <div *ngIf="studyStats().accuracy >= 90" class="excellent">
        <span class="star-icon"></span>
        <span>Kiváló teljesítmény! Nagyon jól megy!</span>
      </div>
      <div *ngIf="studyStats().accuracy >= 70 && studyStats().accuracy < 90" class="good">
        <span class="thumb-up-icon"></span>
        <span>Jó munka! Még egy kis gyakorlás és tökéletes lesz!</span>
      </div>
      <div *ngIf="studyStats().accuracy < 70" class="needs-work">
        <span class="school-icon"></span>
        <span>Még van mit gyakorolni. Ne add fel, a következő alkalommal jobban fog menni!</span>
      </div>
    </div>
  </div>
  
  <div class="results-actions">
    <button 
      class="result-btn primary-btn"
      (click)="restartStudy()">
      <span class="refresh-icon"></span>
      Újra tanulás
    </button>
    <button class="result-btn secondary-btn" (click)="close(true)">
      <span class="check-icon"></span>
      Befejezés
    </button>
  </div>
</div>

<!-- Empty State -->
<div class="empty-study" *ngIf="studyCards().length === 0 && !showResult()">
  <span class="empty-icon quiz-icon"></span>
  <h3>Nincsenek tanulható kártyák</h3>
  <p *ngIf="studyMode() === 'review'">
    Jelenleg nincsenek ismétlendő kártyák. Próbáld ki a "Összes kártya" módot!
  </p>
  <p *ngIf="studyMode() === 'hard_cards'">
    Nincsenek nehéz kártyák. Próbáld ki a "Összes kártya" módot!
  </p>
  <div class="empty-actions">
    <button 
      class="empty-btn primary-btn"
      (click)="changeStudyMode('classic')">
      Összes kártya tanulása
    </button>
    <button class="empty-btn secondary-btn" (click)="close(false)">
      Bezárás
    </button>
  </div>
</div>
