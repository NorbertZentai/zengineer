<div class="quiz-import-modal">
  <div class="modal-header">
    <ng-container *ngIf="showInfo">
      <div class="info-popup-overlay"></div>
      <div class="info-popup">
        <button class="info-close-btn" (click)="closeInfo()" aria-label="Bezárás">
          <mat-icon>close</mat-icon>
        </button>
        <mat-icon color="primary">info</mat-icon>
        <span>{{ infoText }}</span>
      </div>
    </ng-container>
    <div class="modal-icon">
      <mat-icon color="primary">file_upload</mat-icon>
    </div>
    <h2>Kvíz importálása</h2>
    <button class="info-btn" (click)="toggleInfo()" aria-label="Információ">
      <mat-icon>info</mat-icon>
    </button>
    <button class="close-btn" (click)="onClose()" aria-label="Bezárás">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <div class="modal-body">
    <div class="modal-desc">
      <div class="import-target-selector">
        <button [class.active]="importTarget === 'new'" (click)="importTarget = 'new'">
          <mat-icon>add_circle</mat-icon> Új kvíz
        </button>
        <button [class.active]="importTarget === 'existing'" (click)="importTarget = 'existing'">
          <mat-icon>playlist_add</mat-icon> Meglévőhöz
        </button>
      </div>
    </div>
    <div class="import-mode-selector">
      <button [class.active]="importMode === 'file'" (click)="importMode = 'file'">
        <mat-icon>upload_file</mat-icon> Fájl feltöltés
      </button>
      <button [class.active]="importMode === 'code'" (click)="importMode = 'code'">
        <mat-icon>code</mat-icon> Kód/JSON
      </button>
    </div>
    <div class="import-content">
      <div *ngIf="importMode === 'file'" class="file-mode">
        <label class="file-upload-label">
          <input type="file" accept=".json,.csv" (change)="onFileChange($event)" />
          <span class="file-upload-btn">
            <mat-icon>cloud_upload</mat-icon> Fájl kiválasztása (.json, .csv)
          </span>
        </label>
        <div *ngIf="file" class="file-info">
          <mat-icon color="primary">description</mat-icon>
          <span>{{ file.name }} ({{ file.size / 1024 | number:'1.0-1' }} KB)</span>
        </div>
      </div>
      <div *ngIf="importMode === 'code'" class="code-mode">
        <textarea [(ngModel)]="code" rows="8" [placeholder]="codePlaceholder"></textarea>
      </div>
    </div>
    <div class="import-settings">
      <div *ngIf="importTarget === 'new'" class="new-quiz-block">
        <div class="quiz-inputs-row">
          <label class="quiz-input-label">
            <span class="input-icon">
              <mat-icon>edit</mat-icon>
            </span>
            <input type="text" [(ngModel)]="quizName" placeholder="Új kvíz neve" />
          </label>
          <label class="quiz-input-label">
            <span class="input-icon">
              <mat-icon>category</mat-icon>
            </span>
            <input type="text" [(ngModel)]="category" placeholder="Kategória (pl. Történelem)" />
          </label>
        </div>
        <div class="input-row">
          <div class="public-toggle-group">
            <button type="button"
                    class="toggle-btn"
                    [class.active]="!isPublic"
                    (click)="isPublic = false">
              Private
            </button>
            <button type="button"
                    class="toggle-btn"
                    [class.active]="isPublic"
                    (click)="isPublic = true">
              Public
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="importTarget === 'existing'" class="existing-quiz-settings">
        <label class="quizselect-label">
          <mat-icon>list</mat-icon>
          <select [(ngModel)]="selectedQuizId">
            <option value="" disabled selected>Válassz kvízt</option>
            <option *ngFor="let quiz of quizzes" [value]="quiz.id">{{ quiz.name }}</option>
          </select>
        </label>
      </div>
    </div>
    <div *ngIf="error" class="error-msg">
      <mat-icon color="warn">error</mat-icon>
      <span>{{ error }}</span>
    </div>
    <div *ngIf="success" class="success-msg">
      <mat-icon color="primary">check_circle</mat-icon>
      <span>Sikeres import!</span>
    </div>
  </div>
  <div class="modal-actions">
    <button class="import-btn" (click)="onImport()" [disabled]="isLoading">
      <mat-icon>file_download</mat-icon> Importálás
    </button>
    <button class="cancel-btn" (click)="onClose()">
      <mat-icon>close</mat-icon> Mégse
    </button>
  </div>
</div>
